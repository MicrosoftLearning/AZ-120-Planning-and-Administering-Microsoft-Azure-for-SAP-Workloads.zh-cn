---
lab:
  title: 使用 Azure SAP 解决方案中心自动部署
  module: Design and implement an infrastructure to support SAP workloads on Azure
---

# AZ 120 模块：设计和实现基础结构以支持 Azure 上的 SAP 工作负载
# 实验室：使用 Azure SAP 解决方案中心自动部署

预计时间：100 分钟

本实验中的所有任务都从 Azure 门户执行

## 目标

完成本实验室后，你将能够：

- 实现使用 Azure SAP 解决方案中心在 Azure 中部署 SAP 工作负载的先决条件
- 使用 Azure SAP 解决方案中心部署将在 Azure 中托管 SAP 工作负载的基础结构

## 练习 1：实现使用 Azure SAP 解决方案中心在 Azure 中部署 SAP 工作负载的先决条件

持续时间：60 分钟

在本练习中，你将实现使用 Azure SAP 解决方案中心在 Azure 中部署 SAP 工作负载的先决条件。 其中包括以下任务：
- 满足目标 Azure 订阅中的 vCPU 要求
- ：为用于执行部署的 Microsoft Entra ID 用户帐户配置 Azure 基于角色的访问控制 (RBAC) 角色分配
- 创建与用于部署的 Azure SAP 解决方案中心关联的存储帐户
- 创建 Azure SAP 解决方案中心要使用的用户分配的托管标识，以便对其自动部署进行身份验证和授权
- 创建要在托管部署的虚拟网络的子网中使用的网络安全组 (NSG)
- 创建要在托管部署的虚拟网络的子网中使用的路由表
- 创建并配置托管部署的虚拟网络
- 将 Azure 防火墙部署到托管部署的虚拟网络中
- 将 Azure Bastion 部署到托管部署的虚拟网络中

该练习由以下任务组成：

- 任务 1：满足目标 Azure 订阅中的 vCPU 要求
- 任务 2：为用于执行部署的 Microsoft Entra ID 用户帐户配置 Azure 基于角色的访问控制 (RBAC) 角色分配
- 任务 3：创建与用于部署的 Azure SAP 解决方案中心关联的存储帐户
- 任务 4：创建和配置 Azure SAP 解决方案中心要使用的用户分配的托管标识，以便对其自动部署进行身份验证和授权
- 任务 5：创建要在托管部署的虚拟网络的子网中使用的网络安全组 (NSG)
- 任务 6：创建要在托管部署的虚拟网络的子网中使用的路由表
- 任务 7：创建并配置托管部署的虚拟网络
- 任务 8：将 Azure 防火墙部署到托管部署的虚拟网络中
- 任务 9：将 Azure Bastion 部署到托管部署的虚拟网络中

### 任务 1：满足目标 Azure 订阅中的 vCPU 要求

>**注意**：若要按照说明完成此实验室，需要一个 Microsoft Azure 订阅，其 vCPU 配额可容纳以下 VM 的部署：

- 对于 ASCS 层，2 个 Standard_E4ds_v4 VM（每个 VM 4 个 vCPU 和 32 GiB 内存）或 2 个 Standard_D4ds_v4 VM（每个 VM 4 个 vCPU 和 16 GiB 内存）
- 对于应用层，2 个 Standard_E4ds_v4 VM（每个 VM 4 个 vCPU 和 32 GiB 内存）或 2 个 Standard_D4ds_v4 VM（每个 VM 4 个 vCPU 和 16 GiB 内存） 
- 对于数据层，2 个 Standard_M64ms VM（每个 VM 64 个 vCPU 和 1750 GiB 内存）

>**注意**：为了最大程度降低数据库 VM 的 vCPU 和内存要求，可以将 VM SKU 更改为 Standard_M32ts（每个 32 个 vCPU 和 192 GiB 内存）。

1. 从实验室计算机中启动 Web 浏览器，并导航到 Azure 门户 ( )。
1. 在 Azure 门户中，选择“Cloud Shell”图标，在 Cloud Shell 中打开一个 PowerShell 会话****。 

    > **注意**：如果这是你第一次在要在本实验室中使用的 Azure 订阅中启动 Cloud Shell，系统会要求你创建 Azure 文件共享以保留 Cloud Shell 文件。 如果是，接受默认设置，这样会在自动生成的资源组中创建存储账户。

1. 在 Azure 门户的 Cloud Shell 窗格中，在 PowerShell 提示符处运行以下命令：其中 `<Azure_region>` 指定你打算在本实验室中部署资源的 Azure 区域（例如 `eastus`）：****

    ```powershell
    Get-AzVMUsage -Location '<Azure_region>' | Where-Object {$_.Name.Value -eq 'standardEDSv4Family'}
    Get-AzVMUsage -Location '<Azure_region>' | Where-Object {$_.Name.Value -eq 'standardDSv4Family'}
    Get-AzVMUsage -Location '<Azure_region>' | Where-Object {$_.Name.Value -eq 'standardMSFamily'}
    Get-AzVMUsage -Location '<Azure_region>' | Where-Object {$_.Name.Value -eq 'cores'}
    ```

    > **注意**：若要确定 Azure 区域的名称，请在 Cloud Shell 的 Bash 提示符下运行 `(Get-AzLocation).Location`。****

1. 查看输出以确定当前 vCPU 使用情况和 vCPU 限制。 确保它们之间的差异足以容纳将在本实验室中部署的 Azure VM 的 vCPU。 同时考虑特定于 VM 系列的 vCPU 数和区域 vCPU 总数。 
1. 如果 vCPU 数不足，请关闭“Cloud Shell”窗格，在 Azure 门户的“搜索”文本框中，搜索并选择“配额”********。
1. 在“配额”页上，选择“计算”********。
1. 在“配额 \| 计算”页上，使用“区域”筛选器选择要在此实验室中部署资源的 Azure 区域********。
1. 在“配额名称”列中，找到并选择需要增加配额的 VM SKU 名称****。 
1. 在同一行中，查看“可调整”列中的条目****。 下一步取决于该列中包含的条目是“是”还是“否”********。

   - 如果该条目设置为“是”，请选择“请求调整”图标，在“新建配额请求”的“新限制”文本框中，输入新的配额限制，然后选择“提交”********************。
   - 如果该条目设置为“否”，请选择“请求访问权限或获取建议”图标，在“配额建议”窗格中，选择“联系支持人员”选项，然后选择“下一步”********************。 
1. 在“新建支持请求”页的“问题描述”选项卡上，指定以下设置，然后选择“下一步”************：

    |设置|“值”|
    |---|---|
    |你的问题与哪些内容相关？|**Azure 服务**|
    |问题类型|“服务和订阅限制(配额)”****|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |配额类型|计算/VM（核心数/vCPU 数）订阅限制提高****|

1. 在“其他详细信息”选项卡上，选择“输入详细信息”********。
1. 在“配额详细信息”选项卡的“部署模型”下拉列表中，选择“资源管理器”，在“位置”下拉列表中选择目标 Azure 区域，在“配额”下拉列表中，选择需要增加其配额限制的 Azure VM 系列，在“新限制”文本框中，输入新的配额限制，然后选择“保存并继续”****************************。
1. 返回“其他详细信息”选项卡，在“高级诊断信息”选项卡中，选择“是(建议)”************。
1. 在“支持方法”部分中，选择“电子邮件”或“电话”作为首选联系方法，然后选择“下一步”****************。
1. 在“查看 + 创建”选项卡上，选择“创建”。

    > **注意**：请等到增加配额限制的请求成功完成后再继续执行下一个任务。

### 任务 2：为用于执行部署的 Microsoft Entra ID 用户帐户配置 Azure 基于角色的访问控制 (RBAC) 角色分配

1. 在实验室计算机上启动 Microsoft Edge，并导航到 Azure 门户 (`https://portal.azure.com`)。
1. 当系统提示进行身份验证时，请使用 Microsoft Entra ID 凭据以及将用于本实验室的 Azure 订阅的“所有者”角色登录。 
1. 在 Azure 门户的“搜索”文本框中，搜索并选择“订阅”********。
1. 在“订阅”页上，选择表示将用于本实验室的 Azure 订阅的条目****。 
1. 在显示 Azure 订阅属性的页上，选择“访问控制(IAM)”****。
1. 在“访问控制(IAM)”页上，选择“+ 添加”，然后从下拉菜单中选择“添加角色分配”************。
1. 在“添加角色分配”页的“角色”选项卡上，在“作业功能角色”列表中搜索并选择“Azure Sap 解决方案中心管理员”条目，然后选择“下一步”********************。
1. 在“添加角色分配”页的“成员”选项卡上，单击“+ 选择成员”************。 
1. 在“选择成员”窗格的“选择”文本框中，输入用于访问此实验室所用 Azure 订阅的 Microsoft Entra ID 用户帐户名称，在与输入匹配的结果列表中选择该帐户名称，然后单击“选择”************。
1. 回到“成员”选项卡上，选择“查看 + 分配”********。
1. 在“查看 + 分配”选项卡上，选择“查看 + 分配”********。
1. 重复上述六个步骤，将“托管标识操作员”角色分配给用于本实验室的用户帐户****。

### 任务 3：创建与用于部署的 Azure SAP 解决方案中心关联的存储帐户

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“存储帐户”********。
1. 在“存储帐户”页上，选择“+ 创建” 。
1. 在“创建存储帐户”页的“基本信息”选项卡上，指定以下设置并选择“下一页: ************ 高级 &gt;”。

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|新资源组的名称 ACSS-DEMO********|
    |存储帐户名称|由字母和数字组成、长度介于 3 到 24 个字符之间的任意全局唯一名称|
    |区域|**美国东部**|
    |性能|**标准**|
    |冗余|**异地冗余存储 (GRS)**|
    |在区域可用的情况下，提供对数据的读取访问|已禁用|

1. 在“高级”选项卡上，查看可用选项，接受默认设置，然后选择“下一页: ******** 网络 >”。
1. 在“网络”选项卡上，查看可用选项，确保启用选项“启用来自所有网络的公共访问”，然后选择“查看”************。
1. 在“查看”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：不要等待 Azure 存储帐户预配完成。 而是继续执行下一个任务。 预配可能需要大约 2 分钟。

### 任务 4：创建和配置 Azure SAP 解决方案中心要使用的用户分配的托管标识，以便对其自动部署进行身份验证和授权

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“托管标识”********。
1. 在“托管标识”页上，选择“+ 创建”********。
1. 在“创建用户分配的托管标识”页的“基本信息”选项卡上，指定以下设置，然后选择“查看 + 创建”************：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|ACSS-DEMO****|
    |区域|**美国东部**|
    |名称|Contoso-MSI****|

1. 在“查看”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：请等待用户分配的托管标识预配完成。 这应该只需要几秒钟时间。

1. 在 Azure 门户中，导航到“托管标识”页，然后选择“Contoso-MSI”条目********。
1. 在“Contoso-MSI”页上，选择“Azure 角色分配”********。
1. 在“Azure 角色分配”页上，选择“+ 添加角色分配(预览版)”********。
1. 在“+ 添加角色分配(预览版)”窗格上，指定以下设置并选择“保存”********：

    |设置|值|
    |---|---|
    |范围|**订阅**|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |角色|**Azure SAP 解决方案中心服务角色**|

2. 回到“Azure 角色分配”页上，选择“+ 添加角色分配(预览版)”********。
3. 在“+ 添加角色分配(预览版)”窗格上，指定以下设置并选择“保存”********：

    |设置|值|
    |---|---|
    |作用域|**存储**|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源|你在前面的任务中创建的 Azure 存储帐户的名称|
    |角色|**读取器和数据访问**|

### 任务 5：创建要在托管部署的虚拟网络的子网中使用的网络安全组 (NSG)

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“网络安全组”********。
1. 在“网络安全组”页上，选择“+ 创建”。
1. 在“创建网络安全组”页的“基本信息”选项卡上，指定以下设置，然后选择“查看 + 创建”************：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|新资源组的名称 CONTOSO-VNET-RG********|
    |名称|ACSS-DEMO-NSG****|
    |区域|**美国东部**|

1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：默认情况下，网络安全组的内置规则允许所有出站流量、同一虚拟网络中的所有流量以及对等互连虚拟网络之间的所有流量。 这足以成功完成实验室。 根据安全要求，可以考虑阻止其中一些流量。 如果要这样做，请参阅 Microsoft Learn 文档[为基础结构部署准备网络](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/prepare-network)中包含的指南。

### 任务 6：创建要在托管部署的虚拟网络的子网中使用的路由表

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“路由表”********。
1. 在“路由表”页上，选择“+ 创建”********。
1. 在“创建路由表”页的“基本信息”标签上，指定以下设置，然后选择“查看 + 创建”************：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |区域|**美国东部**|
    |名称|ACSS-ROUTE****|
    |传播网关路由|**否**|

1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。

### 任务 7：创建并配置托管部署的虚拟网络

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“虚拟网络”********。 
1. 在“虚拟网络”页面上，选择“+ 创建”。
1. 在“创建虚拟机”页的“基本信息”选项卡中，指定以下设置并选择“下一页:************

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |虚拟网络名称|CONTOSO-VNET****|
    |区域|**（美国）美国东部**|

1. 在“安全性”选项卡上，接受默认设置并选择“下一步”。********

    >**注意**：此时可以同时预配 Azure Bastion 和 Azure 防火墙，但在创建虚拟网络后，将单独预配它们。

1. 在“IP 地址”选项卡上，指定以下设置，然后选择“查看 + 创建”********：

    |设置|“值”|
    |---|---|
    |IP 地址空间|10.5.0.0/16（65,536 个地址）****|

    >**注意**：删除任何预先创建的子网条目。 创建虚拟网络后，将添加子网。

1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。
1. 导航回“虚拟网络”页，选择“CONTOSO-VNET”条目********。 
1. 在“CONTOSO-VNET”页上，在页面左侧的垂直菜单栏中，选择“子网”********。
1. 在“CONTOSO-VNET \| 子网”页上，选择“+ 子网”********。 
1. 在“添加子网”窗格中，指定以下设置，然后选择“保存”********：

    |设置|值|
    |---|---|
    |名称|app****|
    |子网地址范围|**10.5.0.0/24**|
    |网络安全组|ACSS-DEMO-NSG****|
    |路由表|ACSS-ROUTE****|

1. 返回“CONTOSO-VNET \| 子网”页，选择“+ 子网”********。 
1. 在“添加子网”窗格中，指定以下设置，然后选择“保存”********：

    |设置|值|
    |---|---|
    |名称|**AzureBastionSubnet**|
    |子网地址范围|10.5.1.0/26****|

1. 返回“CONTOSO-VNET \| 子网”页，选择“+ 子网”********。 
1. 在“添加子网”窗格中，指定以下设置，然后选择“保存”********：

    |设置|值|
    |---|---|
    |名称|**db**|
    |子网地址范围|10.5.2.0/24****|
    |网络安全组|ACSS-DEMO-NSG****|
    |路由表|ACSS-ROUTE****|

1. 返回“CONTOSO-VNET \| 子网”页，选择“+ 子网”********。 
1. 在“添加子网”窗格中，指定以下设置，然后选择“保存”********：

    |设置|值|
    |---|---|
    |名称|**AzureFirewallSubnet**|
    |子网地址范围|10.5.3.0/24****|

### 任务 8：将 Azure 防火墙部署到托管部署的虚拟网络中

>**注意**：在部署 Azure 防火墙实例之前，请首先创建防火墙策略和实例要使用的公共 IP 地址。

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“防火墙策略”********。
1. 在“防火墙策略”页上，选择“+ 创建”********。
1. 在“创建 Azure 防火墙策略”页的“基本信息”选项卡中，指定以下设置并选择“下一页: ************ DNS 设置 >”：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |名称|FirewallPolicy_contoso-firewall****|
    |区域|**美国东部**|
    |策略层|**标准**|
    |父策略|**无**|

1. 在“DNS 设置”选项卡上，接受默认的“已禁用”选项，然后选择“下一页: ************ TLS 检查 >”。
1. 在“TLS 检查”选项卡上，选择“下一页: ******** 规则 >”。
1. 在“规则”**** 选项卡上，选择“+ 添加规则集合”****。
1. 在“添加规则集合”窗格中，指定以下设置****：

    |设置|值|
    |---|---|
    |名称|AllowOutbound****|
    |规则集合类型|**Network**|
    |优先级|**101**|
    |规则集合操作|**允许**|
    |规则集合组|DefaultNetworkRuleCollectionGroup|

1. 在“添加规则集合”窗格的“规则”部分中，添加具有以下设置的规则********：

    |设置|值|
    |---|---|
    |名称|**RHEL**|
    |源类型|**IP 地址**|
    |源|*|
    |协议|**任意**|
    |目标端口|*|
    |目标类型|**IP 地址**|
    |目标|13.91.47.76,40.85.190.91,52.187.75.218,52.174.163.213,52.237.203.198****|

    >**注意**：若要标识用于 RHEL 的 IP 地址，请参阅[为基础结构部署准备网络](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/prepare-network)

    |设置|值|
    |---|---|
    |名称|ServiceTags****|
    |源类型|**IP 地址**|
    |源|*|
    |协议|**任意**|
    |目标端口|*|
    |目标类型|**服务标记**|
    |目标|AzureActiveDirectory,AzureKeyVault,Storage****|

    >**注意**：如果愿意，可以使用具有区域范围的服务标签。 

    |设置|值|
    |---|---|
    |名称|**SUSE**|
    |源类型|**IP 地址**|
    |源|*|
    |协议|**任意**|
    |目标端口|*|
    |目标类型|**IP 地址**|
    |目标|52.188.224.179,52.186.168.210,52.188.81.163,40.121.202.140****|

    >**注意**：若要标识用于 SUSE 的 IP 地址，请参阅[为基础结构部署准备网络](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/prepare-network)

    |设置|值|
    |---|---|
    |名称|AllowOutbound****|
    |源类型|**IP 地址**|
    |源|*|
    |协议|TCP,UDP,ICMP,Any****|
    |目标端口|*|
    |目标类型|**IP 地址**|
    |目标|*|

1. 选择“添加”按钮以保存所有规则****。
1. 返回“规则”选项卡，选择“下一页: ******** IDPS >”。
1. 在“IDPS”选项卡上，选择“下一页: ******** 威胁情报 >”。

    >**注意**：IDPS 功能需要高级 SKU。

1. 在“威胁情报”选项卡上，查看可用设置而不进行任何更改，然后选择“查看 + 创建”********。
1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：请等待防火墙策略预配完成。 预配大约需要 1 分钟。

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“公共 IP 地址”********。
1. 在“公共 IP 地址”页上，选择“+ 创建”********。
1. 在“创建公共 IP 地址”页的“基本信息”选项卡上，指定以下设置，然后选择“查看 + 创建”************：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |区域|**（美国）美国东部**|
    |名称|contoso-firewal-pip****|
    |IP 版本|**IPv4**|
    |SKU|**标准**|
    |可用性区域|无区域****|
    |层|**Regional**|
    |路由首选项|**Microsoft 网络**|
    |空闲超时(分钟)|**4**|
    |DNS 名称标签|未设置|

1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：请等待公共 IP 地址预配完成。 预配大约需要几秒钟。

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“防火墙”********。
1. 在“防火墙”页上，选择“+ 创建”********。
1. 在“创建防火墙”页的“基本信息”选项卡上，指定以下设置，然后选择“查看 + 创建”************：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |名称|contoso-firewall****|
    |区域|**美国东部**|
    |可用性区域|**无**|
    |防火墙 SKU|**标准**|
    |防火墙管理|**使用防火墙策略来管理此防火墙**|
    |防火墙策略|FirewallPolicy_contoso-firewall****|
    |选择虚拟网络|**使用现有项**|
    |虚拟网络|CONTOSO-VNET****|
    |公共 IP 地址|contoso-firewall-pip****|
    |强制隧道|**已禁用**|

    >**注意**：请等待 Azure 防火墙预配完成。 预配可能需要大约 3 分钟。

1. 在 Azure 门户中，导航回“防火墙”页****。
1. 在“防火墙”页上，选择“contoso-firewall”条目********。
1. 在“contoso-firewall”页上，请注意“专用 IP”条目设置为“10.5.3.4”，表示 Azure 防火墙实例的专用 IP 地址************。

    >**注意**：为了通过 Azure 防火墙路由网络流量，需要将用户定义的路由添加到与托管 SAP 部署的虚拟网络的应用和数据库子网关联的路由表中。

1. 在 Azure 门户的“搜索”文本框中，搜索并选择“路由表”********。
1. 在“路由表”页上，选择“ACSS-ROUTE”条目********。
1. 在“ACSS-ROUTE”页上，选择“路由”********。
1. 在“ACSS-ROUTE \| 路由”页上，选择“+ 添加”********。
1. 在“添加路由”窗格中，指定以下设置，然后选择“添加”********：

    |设置|值|
    |---|---|
    |路由名称|**防火墙**|
    |目标类型|**IP 地址**|
    |目标 IP 地址/CIDR 范围|**0.0.0.0/0**|
    |下一跃点类型|**虚拟设备**|
    |下一跃点地址|10.5.3.4****|

### 任务 9：将 Azure Bastion 部署到托管部署的虚拟网络中

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“Bastion”********。 
1. 在“Bastion”页上，选择“+ 创建”********。
1. 在“Bastion”页的“基本信息”选项卡中，指定以下设置并选择“下一页: ************ 标签 >”：

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|CONTOSO-VNET-RG****|
    |名称|ACSS-BASTION****|
    |区域|**美国东部**|
    |层|**基本**|
    |实例计数|**2**|
    |虚拟网络|CONTOSO-VNET****|
    |子网|**AzureBastionSubnet**|
    |公共 IP 地址|**新建**|
    |公共 IP 地址名称|ACSS-BASTION-PIP****|

1. 在“标签”选项卡上，选择“下一页: ******** 高级 &gt;”
1. 在“高级”选项卡上，查看可用设置而不进行任何更改，然后选择“下一页: ******查看 + 创建 >”**
1. 在“查看 + 创建”选项卡上，等待验证过程完成并选择“创建”********。

    >**注意**：请勿等待堡垒主机预配完成。 而是继续执行下一个任务。 预配可能需要大约 15 分钟。

## 练习 2：使用 Azure SAP 解决方案中心部署将在 Azure 中托管 SAP 工作负载的基础结构

持续时间：40 分钟

在本练习中，你将使用 Azure SAP 解决方案中心将托管 SAP 工作负载的基础结构部署到上一练习使用的 Azure 订阅中。
该练习由以下任务组成：

- 任务 1：创建 SAP 解决方案虚拟实例

### 任务 1：创建 SAP 解决方案虚拟实例

1. 在实验室计算机上，在显示 Azure 门户的 Microsoft Edge 窗口中，在“搜索”文本框中搜索并选择“Azure SAP 解决方案中心”********。 
1. 在“Azure SAP 解决方案中心 \| 概述”页上，选择“创建新的 SAP 系统”********。
1. 在“创建 SAP 解决方案虚拟实例”页的“基本信息”选项卡上，指定以下设置，然后选择“下一页: ************ 虚拟机”

    |设置|值|
    |---|---|
    |订阅|你在此实验室中使用的 Azure 订阅的名称|
    |资源组|新资源组的名称 Contoso-SAP-C1S********|
    |名称 (SID)|C1S****|
    |区域|**（美国）美国东部**|
    |环境类型|**生产**|
    |SAP 产品|S/4HANA****|
    |数据库|HANA|
    |HANA 缩放方法|纵向扩展（推荐）****|
    |部署类型|**分布式，提供高可用性 (HA)**|
    |计算可用性|99.95（可用性集）****|
    |虚拟网络|CONTOSO-VNET****|
    |应用程序子网|应用 (10.5.0.0/24)****|
    |数据库子网|数据库 (10.5.2.0/24)****|
    |应用程序 OS 映像|Red Hat Enterprise Linux 8.2 for SAP Applications - x64 Gen2 最新版****|
    |数据库 OS 映像|Red Hat Enterprise Linux 8.2 for SAP Applications - x64 Gen2 最新版****|
    |SAP 传输选项|创建新的 SAP 传输目录****|
    |传输资源组|ACSS-DEMO****|
    |存储帐户名称|无条目|
    |身份验证类型|SSH 公共****|
    |用户名|contososapadmin****|
    |SSH 公钥源|生成新密钥对|
    |密钥对名称|contosoc1skey****|
    |SQP FQDN|sap.contoso.com****|
    |托管标识源|使用现有的用户分配的托管标识****|
    |托管标识名称|Contoso-MSI****|

1. 在“虚拟机”选项卡上，指定以下设置****：

    |设置|“值”|
    |---|---|
    |基于以下内容生成建议|SAP 应用程序性能标准 (SAPS) – 选择此选项为应用层和数据库内存大小提供 SAPS，然后单击“生成建议”****|
    |应用层的 SAP|**10000**|
    |数据库的内存大小 (GiB)|**1024**|

1. 选择“生成建议”。
1. 查看 ASCS、应用程序和数据库虚拟机的 VM 大小和数量。 

    >**注意**：如果需要，请通过选择每组虚拟机的“查看所有大小”链接并选择替代大小来调整建议的大小。**** 默认情况下，具有高可用性的分布式部署类型以及上面指定的应用层 SAPS 和数据库内存大小会产生以下 VM SKU 建议：
    - 对于 ASCS VM，2 个 Standard_E4ds_v4（每个 VM 4 个 vCPU 和 32 GiB 内存）
    - 对于应用程序 VM，2 个 Standard_E4ds_v4 VM（每个 VM 4 个 vCPU 和 32 GiB 内存）
    - 对于数据库 VM，2 个 Standard_M64ms VM（每个 VM 64 个 vCPU 和 1750 GiB 内存）

    >**注意**：为了最大程度降低数据库 VM 的 vCPU 和内存要求，请考虑将 VM SKU 更改为 Standard_M32ts（每个 32 个 vCPU 和 192 GiB 内存）。

    >**注意**：如果需要，可以通过选择特定虚拟机 SKU 的“请求配额”链接并提交配额增加请求来请求增加配额。**** 处理请求通常需要几分钟时间。

    >**注意**：Azure SAP 解决方案中心在部署期间强制使用 SAP 支持的 VM SKU。

1. 在“虚拟机”选项卡上的“数据磁盘”部分中，选择“查看和自定义配置”链接************。
1. 在“数据库磁盘配置”页上，查看建议的配置而不进行任何更改，然后选择“关闭”********。
1. 回到“虚拟机”选项卡上，选择“下一页: ******** 可视化体系结构”。
1. 在“可视化体系结构”选项卡上，查看展示建议的体系结构的示意图，然后选择“查看 + 创建”********。
1. 在“查看 + 创建”选项卡上，等待验证过程完成，选中复选框以确认部署区域中有充足的可用配额，以避免遇到“配额不足”错误，然后选择“创建”********。
1. 出现提示时，在“生成新的密钥对”窗口中选择“下载私钥并创建资源”********。

    >**注意**：连接到部署中包含的 Azure VM 所需的私钥将下载到运行本实验室的计算机。

    >备注：请等待部署完成。 这可能需要大约 25 分钟。

>**注意**：部署后，继续执行下一步，即使用 Azure SAP 解决方案中心安装 SAP 软件。

>**重要说明**：部署的资源成本很高，因此，如果不打算在此之后使用实验室，请确保取消预配实验室。 请注意，删除 SAP 解决方案虚拟实例不会删除底层基础结构资源。 若要删除资源，应按以下顺序删除在本实验室过程中创建的以下资源组：

- Contoso-SAP-C1S****
- CONTOSO-VNET-RG****
- ACSS-DEMO****